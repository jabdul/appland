<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define([
  <span class="hljs-string">'lib/json2/json2'</span>,
  <span class="hljs-string">'lib/requirejs/i18n!nls/conf'</span>,
  <span class="hljs-string">'jquery'</span>,
  <span class="hljs-string">'core/util'</span>,
  <span class="hljs-string">'log4javascript'</span>
],
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JSON, AppConfig, $, Util, Log4j)</span> {</span>

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">App</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-comment">/**
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Connection method handler.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>     * @type {Object}
     * @private
     */
    var connection = null;
    /**
     * Environment.
     * DEVELOPMENT | TESTING | PRODUCTION
     * @type {string}
     * @private
     */
    var ENV = '';
    /**
     * Log4javascript console appender.
     * @type {Object}
     * @private
     */
    var LogAppender = null;
    /**
     * Enable or disable logging.
     * @type {boolean}
     * @private
     */
    var isLoggingEnabled = true;
    /**
     * Module or project' configuration.
     * @type {*}
     * @private
     */
    var config = {
      /**
       * Project's name.
       * @type {string} projectName_
       */
      projectName_: '',
      /**
       * Libraries required by project.
       * @type {Object.&lt;string&gt;}
       */
      libs_: {},
      /**
       * Global configuration data.
       * The configuration setup is in /src/nls/ according to locale. Changes 
       * in the configuration file will affect all module instances.
       * @type {Object.&lt;string&gt;}
       */
      mainConfig_: AppConfig,
      /**
       * Module specific configuration data. The configuration for each module
       * can be setup in /src/module-?/nls/ files.
       * @type {Object.&lt;string&gt;}
       */
      modules_: {}
    };

    /**
     * App's Bootstrapping.
     * These actions are performed before DOM Ready.
     */
    function init() {
      setEnv();
      setLogAppender();
    }
    /**
     * Console logger.
     * Create a console appender that is inherited by all loggers (modules).
     * Once the logger is setup in the module during App bootstrapping. You can
     * initiate the logging by the following example:
     * @example var Log = App.getModuleConfig('module-image-viewer').Log;
     *              Log.trace('Hello World');
     *              Log.debug('Hello World');
     *              Log.info('Hello World');
     *              Log.error('Hello World');
     *              Log.warn('Hello World');
     *              Log.fatal('Hello World');
     * @see stackoverflow.com/questions/4872505/how-to-use-logging-mechanizm-efficiently
     * @returns {undefined}
     */
    function setLogAppender() {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>To prevent multiple popup windows appearing,
use the existing window instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (LogAppender &amp;&amp; isLoggingEnabled) {
        LogAppender.setUseOldPopUp(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Create new popup console</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      LogAppender = <span class="hljs-keyword">new</span> Log4j.PopUpAppender();</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Change the desired configuration options
LogAppender.setThreshold(Log4j.Level.ALL);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      LogAppender.setFocusPopUp(<span class="hljs-literal">true</span>);
      LogAppender.setNewestMessageAtTop(<span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Limit the number of messages displayed in the console at any one time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      LogAppender.setMaxMessages(<span class="hljs-number">2000</span>);
      Log4j.getRootLogger().addAppender(LogAppender);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Enable all log levels for the “MyApp.Components”
logger and all its descendants 
(including “Apl.Modules.Module1” and
“Apl.Modules.Module2” …)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Log4j.getLogger(<span class="hljs-string">"Apl.Modules"</span>).setLevel(Log4j.Level.ALL);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Enable or disable logging.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Log4j.setEnabled( isLoggingEnabled );
    }
    <span class="hljs-comment">/**
     * Detect current environment.
     * @returns {undefined}
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setEnv</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> host = document.location.host;
      <span class="hljs-keyword">switch</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-regexp">/(^127\.0\.0\.[0-9]|^localhost):901[0-9]/</span>.test(host):
          ENV = <span class="hljs-string">'DEVELOPMENT'</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-regexp">/(^localhost)/</span>.test(host):
          ENV = <span class="hljs-string">'TESTING'</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
          ENV = <span class="hljs-string">'PRODUCTION'</span>;
          <span class="hljs-keyword">break</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Start the App.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    init();

    <span class="hljs-keyword">var</span> publicMethods = {
      <span class="hljs-comment">/**
       * Function Helpers.
       * @type {object}
       * @export
       */</span>
      Util: Util,
      <span class="hljs-comment">/**
       * jQuery.
       * @type {object}
       * @export
       */</span>
      $: $,
      <span class="hljs-comment">/**
       * Modify App's configuration properties.
       * @param {Object.&lt;string&gt;} configObject
       * @returns {boolean} True if successfully updated, False otherwise.
       */</span>
      setConfig: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(configObject)</span> {</span>
        <span class="hljs-keyword">var</span> prop_,
            prop;

        <span class="hljs-keyword">if</span> (Util.getDataType(configObject) != <span class="hljs-string">"[object Object]"</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> configObject) {
          prop_ = prop + <span class="hljs-string">'_'</span>;
          <span class="hljs-keyword">if</span> (prop_ <span class="hljs-keyword">in</span> config) {
            config[prop_] = configObject[prop];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      },
      <span class="hljs-comment">/**
       * Modules's configuration properties.
       * @param {Object.&lt;string&gt;} configObject
       * @returns {boolean} True if successfully updated, False otherwise.
       */</span>
      setModuleConfig: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(configObject)</span> {</span>
        <span class="hljs-keyword">var</span> prop_,
            prop;

        <span class="hljs-keyword">if</span> (Util.getDataType(configObject) != <span class="hljs-string">"[object Object]"</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">for</span> (prop <span class="hljs-keyword">in</span> configObject) {
          prop_ = prop + <span class="hljs-string">'_'</span>;
          config.modules_[prop_] = configObject[prop];
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      },
      <span class="hljs-comment">/**
       * Set up AJAX connection.
       * @param {Object.&lt;string&gt;} o The AJAX handler.
       */</span>
      setConnection: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
        connection = o;
        setLogAppender();
      },
      <span class="hljs-comment">/**
       * Handle AJAX connection requests.
       * @param {string} connectionType The AJAX connection method i.e. JSON, JSONP.
       * @param {Object.&lt;string&gt;} o Connection properties including data, path etc.
       * @returns {undefined}
       */</span>
      connect: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(connectionType, o)</span> {</span>
        connection.request(connectionType, o);
      },
      <span class="hljs-comment">/**
       * Logging configuration.
       * @param {{setEnabled: boolean}} o Logging configuration properties.
       * @returns {undefined}
       */</span>
      setLogging: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
        <span class="hljs-keyword">if</span> (Util.getDataType(o) != <span class="hljs-string">"[object Object]"</span>) {
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> o.setEnabled === <span class="hljs-string">'boolean'</span>) {
          isLoggingEnabled = o.setEnabled;
        }
      },
      <span class="hljs-comment">/**
       * Get config property/properties.
       * @param {string} p Specify configuration property to retrieve.
       * @param {boolean=} all opt_argument Retrieve all configuration settings.
       * @returns {*} Returns False if property does not exist.
       */</span>
      getConfig: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(p, all)</span> {</span>
        <span class="hljs-keyword">if</span> (!all) {
          <span class="hljs-keyword">var</span> prop = p + <span class="hljs-string">'_'</span>;
          <span class="hljs-keyword">if</span> (prop <span class="hljs-keyword">in</span> config) {
            <span class="hljs-keyword">return</span> config[prop];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        }
        <span class="hljs-keyword">if</span> (all) {
          <span class="hljs-keyword">return</span> {
            projectName: config.projectName_,
            libs: config.libs_,
            modules: config.modules_
          };
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      },
      <span class="hljs-comment">/**
       * Get Module-specific configuration properties.
       * @param {string} prop Specify configuration property to retrieve.
       * @param {boolean=} all opt_argument Retrieve all modules' configurations.
       * @returns {boolean} Returns False if property does not exist.
       */</span>
      getModuleConfig: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(prop, all)</span> {</span>
        <span class="hljs-keyword">if</span> (!all) {
          <span class="hljs-keyword">var</span> prop_ = prop + <span class="hljs-string">'_'</span>;
          <span class="hljs-keyword">if</span> (prop_ <span class="hljs-keyword">in</span> config.modules_) {
            <span class="hljs-keyword">return</span> config.modules_[prop_];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        }
        <span class="hljs-keyword">if</span> (all) {
          <span class="hljs-keyword">return</span> config.modules_;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      },
      <span class="hljs-comment">/**
       * Return enviroment setting.
       * @returns {string}
       */</span>
      getEnv: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> ENV;
      },
      <span class="hljs-comment">/**
       * Initialise Google Tag Manager (GTM).
       * @param {Object} w Window object.
       * @param {Object} d Document object.
       * @param {string} s Script tag name.
       * @param {string} l Data layer name.
       * @param {string} i GTM ID.
       * @returns {undefined}
       */</span>
      initGtm: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(w,d,s,l,i)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Create data layer if not exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        w[l]=w[l]||[];
        w[l].push({
          <span class="hljs-string">'gtm.start'</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime(),
          event:<span class="hljs-string">'gtm.js'</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Create script tag to load ga.js and gtm asynchronously</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> f=d.getElementsByTagName(s)[<span class="hljs-number">0</span>],
          j=d.createElement(s),
          dl=l!=<span class="hljs-string">'dataLayer'</span>?<span class="hljs-string">'&amp;l='</span>+l:<span class="hljs-string">''</span>;

        j.async=<span class="hljs-literal">true</span>;
        j.src=<span class="hljs-string">'//www.googletagmanager.com/gtm.js?id='</span>+i+dl;
        f.parentNode.insertBefore(j,f);
      },
      <span class="hljs-comment">/**
       * Initialise Google Analytics.
       * @param {string} accountId GA account ID.
       * @param {Array.&lt;{slot:number,varKey:string,
       *                 varValue:string,scopeLevel:number}&gt;} customVars
       * @param {boolean} trackPageView
       * @returns {undefined}
       */</span>
      initGoogleAnalytics: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(accountId, customVars, trackPageView)</span> {</span>
        window._gaq = window._gaq || [];
        <span class="hljs-keyword">var</span> ga,
            s;
        _gaq.push([<span class="hljs-string">'_setAccount'</span>, accountId]);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = customVars.length; i &lt; len; i++) {
          _gaq.push([
            <span class="hljs-string">'_setCustomVar'</span>,
            customVars[i].slot,
            customVars[i].varKey,
            customVars[i].varValue,
            customVars[i].scopeLevel
          ]);
        }

        <span class="hljs-keyword">if</span> (trackPageView) {
          _gaq.push([<span class="hljs-string">'_trackPageview'</span>]);
        }

        ga = document.createElement(<span class="hljs-string">'script'</span>);
        ga.type = <span class="hljs-string">'text/javascript'</span>;
        ga.async = <span class="hljs-literal">true</span>;
        ga.src = (<span class="hljs-string">'https:'</span> == document.location.protocol ? <span class="hljs-string">'https://ssl'</span>
                  : <span class="hljs-string">'http://www'</span>) + <span class="hljs-string">'.google-analytics.com/ga.js'</span>;
        s = document.getElementsByTagName(<span class="hljs-string">'script'</span>)[<span class="hljs-number">0</span>];
        s.parentNode.insertBefore(ga, s);
      }
    };

    <span class="hljs-keyword">return</span> publicMethods;
  }

  <span class="hljs-keyword">return</span> App();

});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
